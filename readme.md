# DCA
DCA (англ. Data Collection/Acquisition) — сбор и хранение данных. 
Взаимодействие информационных подсистем в целях получения, накопления и передачи технологических и управляющих данных, 
циркулирующих в производственной среде предприятия. 
Функция обеспечивает интерфейс для получения данных и параметров технологических операций, которые используются в формах и документах,
прикрепляемых к единице продукции. Данные могут быть получены с цехового уровня как вручную, так и автоматически от оборудования, 
в требуемом масштабе времени.

## Ограничения
- Станция сбора данных c PLC по протоколу modbus/tcp
- Сервер Historian без масштабирования
- Визуализация стандартными средствами
- Конфигурация станций и серверов выполняется в файлах конфигурации
- Для ускорения процесса конфигурации тегов для станций сбора данных, используем LibreOffice
- Использовать REST API для обмена данными между сервисами.
- Решение должно быть Cloud native (поддерживать контейнеризацию)
- Использовать доступные OpenSource решения.

## Компоненты системы
- RTDS (Real Time Data Server)
- Historian Server
- Grafana

### RTDS (Real Time Data Server)
Обеспечивает сбор данных с PLC по протоколу modbus/tcp (реализуем базовый коннектор расширяя который далее можно делать коннекторы к различным источникам данных) — основная функция собрать текущие данные с PLC в текущий временном срезе, т.е. плоская таблица тегов и их значение + ошибки. Каждый момент времени данные в таблице обновляются. Конфигурация станции делаем с помощью файла конфигурации в формате openoffice электронная таблица (очень удобно собирать название тегов и прочей настройки часто повторяющихся данных).

#### Требования
- Используем буферизацию данных на станции. Станция хранит небольшой буфер с историческими данными, для устранение проблем с сетью.
- Данные хранятся в памяти и в буфере на диске. Для локального хранения буфера используем SQLite.
- Локальный буфер данных использует принцип скользящего окна, должно задаваться в настройках (например: глубина хранение буфера 1 сутки)
- Делаем базовый коннектор и на его базе делаем modbus коннектор и все последующие коннекторы (например: OPC, S7, SQL и т.п.)
- Периодически данные сбрасываются в кэш на диск
Поддержка запуска скриптов для вычисления промежуточных данных
- Поддержка REST API интерфейс для загрузки выгрузки конфигурации и получения данных (текущие и исторические из буфера)
- Поддержка OPC UA и OPC HA если сделать то это будет круто.
- Станций может быть одна или несколько
- Язык программирования Python
- Формировать метрики для Prometeus
- Поддержка контейнеризации

### Historian Server
Центральное хранилище исторических данных, данные требуются для работы аналитиков и MES. Данные собираются коллекторами со станций RTDS и помещаются в хранилище временных рядов.

#### Требования
- Метку времени хранить в UTC
- Настраиваемые коллекторы для сбора данных с RTDS серверов
- Конфигурация коллекторов с помощью файлов конфигурации и файла электронных таблиц OpenOffice
- Конфигурацию храним в SQLite
- Для хранения временных рядов используем QuestDB.
- Должно задаваться глубина хранения исторических данных.
- Для сбора метрик использовать Prometeus
- Для визуализации данных для анализа использовать Grafana с настраиваемыми dashbords.
- Реализовать в Grafana dashboard для визуализации работы RTDS и Historian серверов
- Для визуализации данных из лог файлов использовать OpenSearch

Система вполне может использоваться отдельно от MES системы, поэтому  оформим её отдельным продуктом в репозитории.